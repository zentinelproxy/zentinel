// Sentinel Soak Test Configuration
//
// Minimal configuration for extended stability testing.
// Exercises core proxy functionality without external agents.

server {
    worker-threads 2
    max-connections 10000
    graceful-shutdown-timeout-secs 30
}

listeners {
    listener "http" {
        address "0.0.0.0:8080"
        protocol "http"
        request-timeout-secs 30
    }
}

routes {
    route "api" {
        priority "high"
        matches {
            path-prefix "/api"
        }
        upstream "backend"
        policies {
            timeout-secs 30
            failure-mode "open"
        }
    }

    route "default" {
        priority "low"
        matches {
            path-prefix "/"
        }
        upstream "backend"
        policies {
            timeout-secs 30
            failure-mode "open"
        }
    }
}

upstreams {
    upstream "backend" {
        target "127.0.0.1:8081" weight=1
        load-balancing "round_robin"
        health-check {
            type "http" {
                path "/health"
                expected-status 200
            }
            interval-secs 10
            timeout-secs 5
            healthy-threshold 2
            unhealthy-threshold 3
        }
        connection-pool {
            max-connections 100
            max-idle 20
            idle-timeout 60
        }
    }
}

limits {
    max-header-size-bytes 16384
    max-header-count 100
    max-body-size-bytes 1048576
}

observability {
    metrics {
        enabled #true
        address "0.0.0.0:9090"
        path "/metrics"
    }
    logging {
        level "warn"
        format "json"
    }
}
